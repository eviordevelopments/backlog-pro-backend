name: Keep Render Service Alive

on:
  schedule:
    # Ejecutar cada 14 minutos (cron: minuto hora d√≠a mes d√≠a-semana)
    - cron: '*/14 * * * *'
  workflow_dispatch: # Permite ejecutar manualmente

jobs:
  keep-alive:
    runs-on: ubuntu-latest
    
    steps:
      - name: Ping Render service
        run: |
          echo "üèì Pinging Render service to keep it alive..."
          
          # Reemplaza con tu URL de Render cuando la tengas
          RENDER_URL="${{ secrets.RENDER_SERVICE_URL }}"
          
          if [ -z "$RENDER_URL" ]; then
            echo "‚ö†Ô∏è  RENDER_SERVICE_URL secret not set. Skipping ping."
            exit 0
          fi
          
          # Hacer request al health check GraphQL
          response=$(curl -s -o /dev/null -w "%{http_code}" "$RENDER_URL/graphql" \
            -H "Content-Type: application/json" \
            -d '{"query":"{ health }"}' \
            --max-time 30)
          
          if [ "$response" -eq 200 ]; then
            echo "‚úÖ Service is alive! (HTTP $response)"
          else
            echo "‚ö†Ô∏è  Service returned HTTP $response"
          fi
          
      - name: Log timestamp
        run: |
          echo "‚è∞ Keep-alive executed at: $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
